---
config:
  look: neo
  theme: neo-dark
  layout: dagre
---
flowchart TD
    A(["User Query"]) --> N["Normalize & lowercase
    get cache_key"]
    N --> C{"Cache hit?"}
    C -- Yes --> RF(["Response FAST"])
    C -- No --> E["embed text"]
    E --> V["Neo4j vector search
    idx_issue_embedding
    TOPK=10, cosine"]
    V --> T{"Top-1 similarity 
    â‰¥ threshold?"}
    T -- Yes --> BS["Best solution for Issue"]
    BS --> FF["Format fast answer"]
    FF --> CC["Cache answer"]
    CC --> RF
    T -- No --> SI["find_similar_issues"]
    SI --> GC["get_graph_context"]
    GC --> FP["format_context_for_llm
    compact sections + truncation"]
    FP --> LLM["_call_llm"]
    LLM --> RS(["Response SLOW"])
     E:::note
     V:::note
     BS:::note
     FF:::note
     CC:::note
     SI:::note
     GC:::note
     FP:::note
     LLM:::note
    classDef note fill:#f6f8fa,stroke:#d0d7de,color:#24292f